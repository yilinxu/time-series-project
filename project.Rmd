---
title: "project"
author: "yilin xu"
date: "8/18/2020"
output: 
  html_document:
    theme: cerulean
    highlight: tango
    code_folding: none
    toc: yes
    toc_depth: 3
    toc_float: true
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning=FALSE)
#remove all objects from workspace
rm(list = ls())
# Load necessary packages
install.packages(setdiff(c('TSstudio','readxl','stringr','tseries','fpp2','forecast','EnvStats','olsrr'), rownames(installed.packages())))
library('TSstudio')
library('readxl')
library("dplyr")
library("stringr")
library('tseries')
library('forecast')
library('fpp2')
library('EnvStats')
library('TSA')
library('olsrr')
library('vars')
```
#### Data
For this project, we used US GDP quarterly dataset from 1947 to 2020. The dataset is download from https://fred.stlouisfed.org/series/GDPC1 

### Exploratory Anlyaisis {.tabset}
#### Load dataset
```{r}
data<-read.csv('All_Data.csv')
data_ts<-ts(data,frequency=4,start=c(1967,3))
gdp_ts<-data_ts[,'GDP']
head(gdp_ts)
```

#### Visualize dataset
```{r}
autoplot(gdp_ts)
```

#### Split train and test dataset
```{r}
train_gdp<-window(gdp_ts,end=c(2017,3))
test_gdp<-window(gdp_ts,start=c(2017,4))
length(train_gdp)
length(test_gdp)
```


### Model Construction {.tabset}
#### ETS Model
```{r}
ets_model<-ets(train_gdp)
ets_model
checkresiduals(ets_model)
ets_fc<-forecast(ets_model,h=9)
autoplot(train_gdp) + autolayer(ets_fc,series="ETS forecast")
accuracy(ets_fc$mean,test_gdp)
```

#### ARIMA Model
```{r}
arima_model<-auto.arima(train_gdp)
arima_model
checkresiduals(arima_model)
arima_fc<-forecast(arima_model,h=9)
autoplot(train_gdp) + autolayer(arima_fc,series="ARIMA forecast")
accuracy(arima_fc$mean,test_gdp)
```

### VAR Model {.tabset}
#### Construct mts 
```{r}
data<-read.csv('All_Data.csv')
data_ts<-ts(data,frequency=4,start=c(1967,3))
log_gdp<-log(data_ts[,'GDP'])
log_unrate<-log(data_ts[,'UNRATE'])
log_consop<-log(data_ts[,'CONS_OP'])
log_recprob<-log(data_ts[,'REC_PROB']+0.001)
reorg_ts<-cbind(log_gdp,log_unrate,log_consop,log_recprob)
autoplot(reorg_ts)
```

#### Correlation estimation
```{r}
diff_log_gdp<-diff(log_gdp,lag=1,difference=1)
kpss.test(diff_log_gdp)
diff_log_unrate<-diff(log_unrate,lag=1,difference=1)
plot(diff_log_gdp,diff_log_unrate)
cor(diff_log_gdp,diff_log_unrate)

diff_log_consop<-diff(log_consop,lag=1,difference=1)
kpss.test(diff_log_consop)
plot(diff_log_gdp,diff_log_consop)
cor(diff_log_gdp,diff_log_consop)

diff_log_recprob<-diff(log_recprob,lag=1,difference=1)
kpss.test(diff_log_recprob)
plot(diff_log_gdp,diff_log_recprob)
cor(diff_log_gdp,diff_log_recprob)
```

After applying log transformation and differencing with one lag, gdp,consumer opinion and recession probability are stationary.

By calculating the correlation, GDP are positively correlated with comsumer opinion and negatively correlated with unemployment rate and recession probability.

#### Var Model construction
```{r}
train_gdp<-window(diff_log_gdp,end=c(2017,3))
test_gdp<-window(diff_log_gdp,start=c(2012,4))

train_unrate<-window(diff_log_unrate,end=c(2017,3))
test_unrate<-window(diff_log_unrate,start=c(2017,4))

train_consop<-window(diff_log_unrate,end=c(2017,3))
test_consop<-window(diff_log_unrate,start=c(2017,4))

train_recprob<-window(diff_log_recprob,end=c(2017,3))
test_recprob<-window(diff_log_recprob,start=c(2017,4))

VARselect(cbind(train_gdp,train_unrate))
var_model<-VAR(cbind(train_gdp,train_unrate),p=2,type="both")
summary(var_model)
```

#### Estimate Model
```{r}
serial.test(var_model)
```

#### Predict 
```{r}
forecast_obj<-forecast(var_model,h=9)
autoplot(forecast_obj)
log_gdp_obj = forecast_obj[[2]]$train_gdp
log_gdp_fc = log_gdp_obj[3]$mean
gdp<-exp(diffinv(c(log_gdp[1],train_gdp,log_gdp_fc)))
gdp_fc<-tail(gdp,n=9)
gdp_value<-window(data_ts[,'GDP'],start=c(2017,4))
accuracy(gdp_fc,gdp_value)

```