---
title: "project"
author: "yilin xu"
date: "8/18/2020"
output: 
  html_document:
    theme: cerulean
    highlight: tango
    code_folding: none
    toc: yes
    toc_depth: 3
    toc_float: true
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning=FALSE)
#remove all objects from workspace
rm(list = ls())
# Load necessary packages
install.packages(setdiff(c('TSstudio','readxl','stringr','tseries','fpp2','forecast','EnvStats','olsrr'), rownames(installed.packages())))
library('TSstudio')
library('readxl')
library("dplyr")
library("stringr")
library('tseries')
library('forecast')
library('fpp2')
library('EnvStats')
library('TSA')
library('olsrr')
library('vars')
```
#### Data
For this project, we used US GDP quarterly dataset from 1947 to 2020. The dataset is download from https://fred.stlouisfed.org/series/GDPC1 

### Exploratory Anlyaisis {.tabset}
#### Load dataset
```{r}
gdp_df<-read.csv("GDPC1.csv")
gdp_ts<-ts(gdp_df$GDPC1,frequency=4,start=c(1947,1))
head(gdp_ts)
```

#### Visualize dataset
```{r}
autoplot(gdp_ts)
```

#### Stablize variance
```{r}
lambda<-BoxCox.lambda(gdp_ts)
transform_gdp<-BoxCox(gdp_ts,lambda=lambda)
autoplot(transform_gdp)
```

#### Split train and test dataset
```{r}
train_gdp<-window(transform_gdp,end=c(2017,4))
test_gdp<-window(transform_gdp,start=c(2018,1))
train_gdp
test_gdp
```


### Model Construction {.tabset}
#### ETS Model
```{r}
ets_model<-ets(train_gdp)
ets_model
checkresiduals(ets_model)
ets_fc<-forecast(ets_model,h=8)
autoplot(train_gdp) + autolayer(ets_fc,series="ETS forecast")
accuracy(exp(ets_fc$mean),exp(test_gdp))
```

#### ARIMA Model
```{r}
arima_model<-auto.arima(train_gdp)
arima_model
checkresiduals(arima_model)
arima_fc<-forecast(arima_model,h=8)
autoplot(train_gdp) + autolayer(arima_fc,series="ARIMA forecast")
accuracy(exp(arima_fc$mean),exp(test_gdp))
```

### VAR Model {.tabset}
#### Construct mts 
```{r}
data<-read.csv('All_Data.csv')
data_ts<-ts(data,frequency=4,start=c(1967,3))
log_gdp<-log(data_ts[,'GDP'])
log_unrate<-log(data_ts[,'UNRATE'])
log_consop<-log(data_ts[,'CONS_OP'])
log_recprob<-log(data_ts[,'REC_PROB']+0.001)
reorg_ts<-cbind(log_gdp,log_unrate,log_consop,log_recprob)
autoplot(reorg_ts)
```

#### Correlation estimation
```{r}
diff_log_gdp<-diff(log_gdp,lag=1,difference=1)
plot(diff_log_gdp,log_unrate)
cor(diff_log_gdp,log_unrate[-1])
plot(diff_log_gdp,log_consop)
cor(diff_log_gdp,log_consop[-1])
plot(diff_log_gdp,log_recprob)
cor(diff_log_gdp,log_recprob[-1])
```

Use diff to remove the trend. The investigate the correlation between the gdp and the three variables. Conclusion: GDP is positive correlate with consumer opinion and negatively correlate with recession probability. There is no significant correlation between gdp and the unemployment rate.

#### Var Model construction
```{r}
train_gdp<-window(reorg_ts[,'log_gdp'],end=c(2017,4))
test_gdp<-window(reorg_ts[,'log_gdp'],start=c(2018,1))

train_consop<-window(reorg_ts[,'log_consop'],end=c(2017,4))
test_consop<-window(reorg_ts[,'log_consop'],start=c(2018,1))

train_recprob<-window(reorg_ts[,'log_recprob'],end=c(2017,4))
test_recprob<-window(reorg_ts[,'log_recprob'],start=c(2018,1))

VARselect(cbind(train_gdp,train_consop,train_recprob))
var_model<-VAR(cbind(train_gdp,train_consop,train_recprob),p=4,type="both")
summary(var_model)
```

#### Estimate Model
```{r}
gdp_residuals<-residuals(var_model)[,'train_gdp']
plot(gdp_residuals,type='l')
acf(gdp_residuals)
Box.test(gdp_residuals)
```

#### Predict 
```{r}
forecast_obj<-forecast(var_model,h=8)
log_gdp_obj = forecast_obj[[2]]$train_gdp
log_gdp_fc = log_gdp_obj[3]$mean
autoplot(exp(train_gdp))+ autolayer(exp(log_gdp_fc) ,series="VAR forecast")
log_rec_obj = forecast_obj[[2]]$train_recprob
log_rec_fc = log_rec_obj[3]$mean
autoplot(exp(train_recprob))+ autolayer(exp(log_rec_fc),series="VAR forecast")
log_consop_obj = forecast_obj[[2]]$train_consop
log_consop_fc = log_consop_obj[3]$mean
autoplot(exp(train_consop))+ autolayer(exp(log_consop_fc),series="VAR forecast")
accuracy(exp(test_gdp),exp(log_gdp_fc))
accuracy(exp(test_recprob),exp(log_rec_fc))
accuracy(exp(test_consop),exp(log_consop_fc))
```